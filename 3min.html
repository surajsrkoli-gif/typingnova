<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3 Minute Typing Speed Test | Typing Nova</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* CSS Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Variables - Professional Clean Theme */
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #3b82f6;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --light-bg: #f8fafc;
            --surface: #ffffff;
            --card: #f1f5f9;
            --text: #1e293b;
            --text-light: #64748b;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
            --shadow: rgba(0, 0, 0, 0.05);
            --shadow-hover: rgba(0, 0, 0, 0.1);
            --correct-bg: rgba(16, 185, 129, 0.1);
            --incorrect-bg: rgba(239, 68, 68, 0.1);
            --current-bg: rgba(37, 99, 235, 0.1);
            --timer-red: #dc2626;
            --timer-yellow: #d97706;
            --timer-green: #059669;
        }

        /* Base Styles */
        body {
            font-family: 'Inter', sans-serif;
            color: var(--text);
            background-color: var(--light-bg);
            line-height: 1.5;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            font-size: 15px;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 10px 22px;
            border-radius: 6px;
            font-weight: 500;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.15s ease;
            border: none;
            font-family: 'Inter', sans-serif;
            gap: 6px;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .btn-secondary {
            background-color: var(--surface);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background-color: var(--card);
            transform: translateY(-1px);
        }

        /* Header */
        header {
            padding: 15px 0;
            background-color: var(--surface);
            border-bottom: 1px solid var(--border);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 20px;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo span {
            color: var(--primary);
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            color: var(--text-light);
            font-weight: 500;
            font-size: 14px;
            transition: color 0.15s;
        }

        .nav-links a:hover {
            color: var(--primary);
        }

        /* Main Content */
        main {
            flex: 1;
            padding: 30px 0;
        }

        /* Page Header */
        .page-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .page-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--text);
            font-weight: 600;
        }

        .page-header p {
            color: var(--text-light);
            font-size: 16px;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Timer & Info Bar */
        .info-bar {
            background-color: var(--surface);
            padding: 18px 0;
            border-radius: 8px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px var(--shadow);
            border: 1px solid var(--border);
        }

        .info-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .info-item {
            text-align: center;
            flex: 1;
        }

        .info-label {
            font-size: 12px;
            color: var(--text-muted);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            font-size: 32px;
            font-weight: 600;
        }

        .timer {
            color: var(--timer-green);
            font-family: 'Courier New', monospace;
        }

        .error-count {
            color: var(--error);
        }

        /* Typing Container */
        .typing-container {
            background-color: var(--surface);
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px var(--shadow);
            border: 1px solid var(--border);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 18px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Passage Display */
        .passage-display {
            background-color: var(--card);
            border-radius: 6px;
            padding: 24px;
            margin-bottom: 25px;
            border: 1px solid var(--border);
            font-size: 17px;
            line-height: 1.7;
            min-height: 150px;
            max-height: 250px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Inter', sans-serif;
        }

        /* Character styling */
        .char {
            padding: 1px 0;
            border-radius: 2px;
            transition: all 0.1s;
            position: relative;
        }

        .char.correct {
            background-color: var(--correct-bg);
            color: var(--success);
        }

        .char.incorrect {
            background-color: var(--incorrect-bg);
            color: var(--error);
            text-decoration: line-through;
        }

        .char.current {
            background-color: var(--current-bg);
            border-bottom: 2px solid var(--primary);
            animation: pulse 1.5s infinite;
        }

        .char.current::after {
            content: '|';
            position: absolute;
            right: -2px;
            color: var(--primary);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        @keyframes pulse {
            0% { background-color: var(--current-bg); }
            50% { background-color: rgba(37, 99, 235, 0.2); }
            100% { background-color: var(--current-bg); }
        }

        /* Typing Input */
        .typing-input-container {
            margin-top: 20px;
        }

        .typing-input {
            width: 100%;
            height: 140px;
            padding: 18px;
            background-color: var(--card);
            color: var(--text);
            border: 2px solid var(--border);
            border-radius: 6px;
            resize: none;
            font-size: 17px;
            line-height: 1.7;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.15s;
        }

        .typing-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .typing-input.disabled {
            background-color: var(--surface);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .typing-input::placeholder {
            color: var(--text-muted);
            font-style: italic;
        }

        /* Instructions */
        .instructions {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 18px;
            margin: 25px 0;
            padding: 18px;
            background-color: var(--surface);
            border-radius: 6px;
            border: 1px solid var(--border);
        }

        .instruction-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-light);
        }

        .instruction-item i {
            font-size: 13px;
        }

        /* Start Button */
        .start-section {
            text-align: center;
            margin: 25px 0;
        }

        /* Results Section */
        .results-container {
            display: none;
            background-color: var(--surface);
            border-radius: 8px;
            padding: 35px;
            margin: 30px 0;
            box-shadow: 0 2px 8px var(--shadow);
            border: 1px solid var(--border);
        }

        .results-container.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .results-header h2 {
            font-size: 26px;
            margin-bottom: 10px;
            color: var(--text);
            font-weight: 600;
        }

        .results-header p {
            color: var(--text-light);
            font-size: 16px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            text-align: center;
            padding: 25px 15px;
            background-color: var(--card);
            border-radius: 8px;
            border: 1px solid var(--border);
        }

        .result-value {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .result-label {
            font-size: 14px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-wpm {
            border-top: 4px solid var(--primary);
        }

        .result-errors {
            border-top: 4px solid var(--error);
        }

        .result-accuracy {
            border-top: 4px solid var(--success);
        }

        .result-time {
            border-top: 4px solid var(--secondary);
        }

        .results-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
        }

        /* Footer */
        footer {
            background-color: var(--surface);
            color: var(--text);
            padding: 30px 0 20px;
            border-top: 1px solid var(--border);
            margin-top: auto;
        }

        .footer-content {
            text-align: center;
        }

        .footer-logo {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .footer-logo span {
            color: var(--primary);
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
        }

        .footer-links a {
            color: var(--text-light);
            transition: color 0.15s;
            font-size: 13px;
        }

        .footer-links a:hover {
            color: var(--primary);
        }

        .copyright {
            text-align: center;
            padding-top: 15px;
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: 12px;
        }

        /* Ad Container */
        .ad-container {
            margin: 35px 0;
            text-align: center;
            color: var(--text-muted);
            font-size: 14px;
            padding: 25px;
            background-color: var(--surface);
            border-radius: 8px;
            border: 1px dashed var(--border);
            display: none;
        }

        .ad-container.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* Progress Bar */
        .progress-container {
            margin: 20px 0;
        }

        .progress-bar {
            height: 6px;
            background-color: var(--border);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 3px;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-links {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .info-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .info-item {
                width: 100%;
            }
            
            .page-header h1 {
                font-size: 24px;
            }
            
            .results-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .results-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 250px;
            }
            
            .typing-container {
                padding: 20px;
            }
        }

        @media (max-width: 576px) {
            .page-header h1 {
                font-size: 22px;
            }
            
            .passage-display, .typing-input {
                font-size: 16px;
                padding: 18px;
            }
            
            .info-value {
                font-size: 28px;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .result-value {
                font-size: 32px;
            }
            
            .instructions {
                flex-direction: column;
                align-items: center;
                gap: 12px;
            }
        }

        @media (max-width: 480px) {
            .typing-input {
                height: 120px;
            }
            
            .passage-display {
                max-height: 200px;
            }
            
            .result-value {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <a href="index.html" class="logo">
                <i class="fas fa-keyboard"></i>
                Typing<span>Nova</span>
            </a>
            <nav class="nav-links">
                <a href="index.html">Home</a>
                <a href="1-minute-test.html">1 Minute</a>
                <a href="passage-typing.html">Passage</a>
                <a href="about.html">About</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <h1>3 Minute Typing Speed Test</h1>
                <p>Measure your typing speed and accuracy over a consistent 3-minute period. Focus on steady, accurate typing.</p>
            </div>

            <!-- Timer & Info Bar -->
            <div class="info-bar">
                <div class="container info-content">
                    <div class="info-item">
                        <div class="info-label">Time Remaining</div>
                        <div class="info-value timer" id="timeRemaining">03:00</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Errors</div>
                        <div class="info-value error-count" id="errorCount">0</div>
                    </div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <!-- Typing Container -->
            <div class="typing-container">
                <!-- Passage Display -->
                <div class="section-title">
                    <i class="fas fa-align-left"></i>
                    Type This Passage
                </div>
                <div class="passage-display" id="passageDisplay">
                    Loading passage...
                </div>

                <!-- Typing Input -->
                <div class="section-title">
                    <i class="fas fa-keyboard"></i>
                    Your Typing
                </div>
                <div class="typing-input-container">
                    <textarea 
                        class="typing-input" 
                        id="typingInput" 
                        placeholder="Start typing the passage above. The 3-minute timer will begin with your first keystroke."
                        spellcheck="false"
                        autocomplete="off"
                        autocorrect="off"
                        autocapitalize="off"
                    ></textarea>
                </div>
            </div>

            <!-- Instructions -->
            <div class="instructions">
                <div class="instruction-item">
                    <i class="fas fa-info-circle" style="color: var(--primary);"></i>
                    <span>Timer starts with first keystroke</span>
                </div>
                <div class="instruction-item">
                    <i class="fas fa-exclamation-triangle" style="color: var(--error);"></i>
                    <span>Errors counted even if corrected</span>
                </div>
                <div class="instruction-item">
                    <i class="fas fa-clock" style="color: var(--success);"></i>
                    <span>Exactly 3 minutes test duration</span>
                </div>
                <div class="instruction-item">
                    <i class="fas fa-chart-line" style="color: var(--secondary);"></i>
                    <span>Measure consistent typing performance</span>
                </div>
            </div>

            <!-- Start Button Section -->
            <div class="start-section">
                <button class="btn btn-primary" id="startTestBtn">
                    <i class="fas fa-play"></i>
                    Start 3-Minute Test
                </button>
                <button class="btn btn-secondary" id="newPassageBtn" style="margin-left: 12px;">
                    <i class="fas fa-sync-alt"></i>
                    New Passage
                </button>
            </div>

            <!-- Results Section -->
            <div class="results-container" id="resultsContainer">
                <div class="results-header">
                    <h2>3-Minute Typing Test Results</h2>
                    <p>Your consistent typing performance over 3 minutes</p>
                </div>
                <div class="results-grid">
                    <div class="result-card result-time">
                        <div class="result-value" id="resultTime">3:00</div>
                        <div class="result-label">Time Duration</div>
                    </div>
                    <div class="result-card result-wpm">
                        <div class="result-value" id="resultWPM">0</div>
                        <div class="result-label">Words Per Minute</div>
                    </div>
                    <div class="result-card result-errors">
                        <div class="result-value" id="resultErrors">0</div>
                        <div class="result-label">Total Errors</div>
                    </div>
                    <div class="result-card result-accuracy">
                        <div class="result-value" id="resultAccuracy">100%</div>
                        <div class="result-label">Accuracy</div>
                    </div>
                </div>
                <div class="results-actions">
                    <button class="btn btn-primary" id="tryAgainBtn">
                        <i class="fas fa-redo"></i>
                        Try Again
                    </button>
                    <button class="btn btn-secondary" id="newTestBtn">
                        <i class="fas fa-sync-alt"></i>
                        New Test
                    </button>
                </div>
            </div>

            <!-- Ad Container (Only shows after results) -->
            <div class="ad-container" id="adContainer">
                <p>Advertisement Area</p>
                <p style="margin-top: 10px; font-size: 13px; color: var(--text-muted);">
                    This area is designed for AdSense ads. It appears only after completing a typing test.
                </p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <i class="fas fa-keyboard"></i>
                    Typing<span>Nova</span>
                </div>
                <p style="color: var(--text-light); font-size: 14px; margin-bottom: 15px;">
                    Practice typing and improve your speed and accuracy
                </p>
                <div class="footer-links">
                    <a href="index.html">Home</a>
                    <a href="1-minute-test.html">1 Minute</a>
                    <a href="3-minute-test.html">3 Minutes</a>
                    <a href="passage-typing.html">Passage</a>
                    <a href="about.html">About</a>
                </div>
            </div>
            <div class="copyright">
                © <span id="currentYear"></span> Typing Nova – All rights reserved
            </div>
        </div>
    </footer>

    <!-- Font Awesome Icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>

    <script>
        // 3-Minute Typing Speed Test Application
        class ThreeMinuteTypingTest {
            constructor() {
                // DOM Elements
                this.passageDisplay = document.getElementById('passageDisplay');
                this.typingInput = document.getElementById('typingInput');
                this.timeRemaining = document.getElementById('timeRemaining');
                this.errorCount = document.getElementById('errorCount');
                this.progressFill = document.getElementById('progressFill');
                this.startTestBtn = document.getElementById('startTestBtn');
                this.newPassageBtn = document.getElementById('newPassageBtn');
                this.resultsContainer = document.getElementById('resultsContainer');
                this.resultTime = document.getElementById('resultTime');
                this.resultWPM = document.getElementById('resultWPM');
                this.resultErrors = document.getElementById('resultErrors');
                this.resultAccuracy = document.getElementById('resultAccuracy');
                this.tryAgainBtn = document.getElementById('tryAgainBtn');
                this.newTestBtn = document.getElementById('newTestBtn');
                this.adContainer = document.getElementById('adContainer');
                
                // State variables
                this.originalPassage = '';
                this.passageChars = [];
                this.currentPassageIndex = 0;
                this.errors = 0;
                this.startTime = null;
                this.timerInterval = null;
                this.totalTime = 180; // 3 minutes in seconds
                this.timeLeft = this.totalTime;
                this.isRunning = false;
                this.isCompleted = false;
                this.totalTypedChars = 0;
                this.errorMap = new Map();
                
                // Passages database - Medium length passages for 3 minute test
                this.passages = [
                    "Consistent typing practice is essential for developing both speed and accuracy over time. Regular sessions help build muscle memory, allowing fingers to find keys automatically without conscious thought. This automation frees mental capacity for content rather than mechanics, improving overall productivity and efficiency in various digital tasks. Many professionals find that dedicated practice yields measurable improvements within weeks, particularly when focusing on proper technique and minimizing errors through focused attention and repetition of challenging combinations.",
                    
                    "Digital communication has become fundamental to modern work environments, with typing representing a core skill across most professions. Effective written communication requires not only clarity of thought but also the technical ability to transcribe ideas quickly and accurately. As remote work and digital collaboration increase, typing proficiency contributes significantly to professional effectiveness, enabling efficient email correspondence, documentation creation, and real-time messaging. Professionals who type efficiently often experience reduced cognitive load during composition tasks, allowing greater focus on content quality and strategic thinking.",
                    
                    "Learning any skill follows a predictable pattern of initial rapid improvement followed by gradual refinement. Typing development typically begins with memorizing keyboard layouts and basic finger placement, progressing to increased speed through repetitive practice. Intermediate stages involve error reduction and consistency development, while advanced practitioners focus on maintaining accuracy at higher speeds and adapting to different keyboard types or text formats. This progression demonstrates how structured practice with specific goals can transform a mechanical task into an automatic skill through deliberate, consistent effort over time.",
                    
                    "Technology continues reshaping how humans interact with information, with typing remaining a fundamental interface despite voice recognition advances. The physical act of typing engages different cognitive pathways than speech, often leading to more structured thinking and clearer expression. Many writers and thinkers find that the rhythm of typing facilitates flow states where ideas emerge more readily than through other communication methods. This connection between physical action and mental process highlights why typing skills remain valuable even as alternative input methods become more sophisticated and widely available.",
                    
                    "Health considerations for frequent typists include proper ergonomics, regular breaks, and attention to potential repetitive strain issues. Optimal typing posture involves neutral wrist positions, appropriate chair height, and monitor placement that minimizes neck strain. Many experienced typists develop personal techniques that balance speed with comfort, recognizing that sustainable practice requires attention to physical wellbeing alongside technical skill development. These considerations become increasingly important as digital work hours extend, making conscious practice habits valuable for long-term typing comfort and effectiveness.",
                    
                    "Educational systems increasingly recognize typing as a foundational digital literacy skill, introducing instruction at earlier ages than previous generations experienced. This shift reflects changing workplace requirements and the growing importance of digital communication across all professional fields. Early typing instruction often focuses on proper technique rather than speed, establishing habits that support long-term development and reduce injury risk. As technology integration continues across educational contexts, typing proficiency becomes not just a vocational skill but a fundamental component of digital participation and information access.",
                    
                    "Psychological aspects of typing practice include motivation maintenance, goal setting, and progress tracking. Many learners find that measurable metrics like words per minute and accuracy percentages provide concrete feedback that supports continued effort. The satisfaction of observing personal improvement can create positive reinforcement cycles where practice becomes self-motivating rather than purely obligatory. These psychological factors contribute significantly to skill retention and ongoing development, highlighting why structured practice with clear benchmarks often proves more effective than unstructured repetition alone.",
                    "Different text types present varying challenges for typists, from technical documentation requiring precise terminology to creative writing demanding fluid expression. Practice with diverse materials helps develop adaptable skills applicable across multiple contexts. Technical typing might emphasize accuracy with complex terminology and numerical data, while creative typing prioritizes flow and idea capture. This versatility demonstrates why well-rounded typing practice should include varied content types, preparing individuals for the diverse writing demands encountered in professional, academic, and personal digital communication contexts."
                ];
                
                // Initialize the application
                this.init();
            }
            
            init() {
                // Set current year in footer
                document.getElementById('currentYear').textContent = new Date().getFullYear();
                
                // Load initial passage
                this.loadRandomPassage();
                
                // Event listeners
                this.typingInput.addEventListener('input', this.handleTyping.bind(this));
                this.typingInput.addEventListener('keydown', this.handleKeyDown.bind(this));
                this.typingInput.addEventListener('paste', (e) => e.preventDefault());
                this.typingInput.addEventListener('copy', (e) => e.preventDefault());
                this.typingInput.addEventListener('cut', (e) => e.preventDefault());
                
                this.startTestBtn.addEventListener('click', () => {
                    this.typingInput.focus();
                    this.startTestBtn.disabled = true;
                    this.startTestBtn.innerHTML = '<i class="fas fa-play"></i> Test Started';
                    this.startTestBtn.style.opacity = '0.7';
                });
                
                this.newPassageBtn.addEventListener('click', () => this.loadRandomPassage());
                this.tryAgainBtn.addEventListener('click', this.resetTest.bind(this));
                this.newTestBtn.addEventListener('click', () => {
                    this.loadRandomPassage();
                    this.resetTest();
                });
                
                // Set initial state
                this.updatePassageDisplay();
                
                // Hide ad container initially
                this.adContainer.style.display = 'none';
            }
            
            loadRandomPassage() {
                // Select a random passage
                const randomIndex = Math.floor(Math.random() * this.passages.length);
                this.originalPassage = this.passages[randomIndex];
                this.passageChars = this.originalPassage.split('');
                
                // Reset typing state
                this.currentPassageIndex = 0;
                this.errors = 0;
                this.totalTypedChars = 0;
                this.errorMap.clear();
                
                // Reset UI
                this.typingInput.value = '';
                this.typingInput.disabled = false;
                this.typingInput.classList.remove('disabled');
                this.typingInput.focus();
                
                this.startTestBtn.disabled = false;
                this.startTestBtn.innerHTML = '<i class="fas fa-play"></i> Start 3-Minute Test';
                this.startTestBtn.style.opacity = '1';
                
                // Hide results and ads
                this.resultsContainer.classList.remove('active');
                this.adContainer.style.display = 'none';
                
                // Reset timer display
                this.timeRemaining.textContent = '03:00';
                this.timeRemaining.style.color = 'var(--timer-green)';
                this.errorCount.textContent = '0';
                this.progressFill.style.width = '0%';
                
                // Reset timer state
                clearInterval(this.timerInterval);
                this.isRunning = false;
                this.isCompleted = false;
                this.timeLeft = this.totalTime;
                
                this.updatePassageDisplay();
            }
            
            updatePassageDisplay() {
                let displayHTML = '';
                
                for (let i = 0; i < this.passageChars.length; i++) {
                    let charClass = '';
                    let charContent = this.passageChars[i];
                    
                    // Handle special characters for display
                    if (charContent === ' ') {
                        charContent = ' ';
                    } else if (charContent === '\n') {
                        charContent = '\n';
                    }
                    
                    if (i < this.currentPassageIndex) {
                        // Already typed characters
                        if (this.errorMap.has(i)) {
                            charClass = 'incorrect';
                        } else {
                            charClass = 'correct';
                        }
                    } else if (i === this.currentPassageIndex) {
                        // Current character
                        charClass = 'current';
                    }
                    
                    // Handle newlines specially
                    if (charContent === '\n') {
                        displayHTML += `<br><span class="char ${charClass}"> </span>`;
                    } else {
                        displayHTML += `<span class="char ${charClass}">${this.escapeHtml(charContent)}</span>`;
                    }
                }
                
                this.passageDisplay.innerHTML = displayHTML;
                
                // Scroll current character into view if needed
                const currentChar = this.passageDisplay.querySelector('.char.current');
                if (currentChar) {
                    currentChar.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'center' });
                }
            }
            
            escapeHtml(text) {
                const map = {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                };
                return text.replace(/[&<>"']/g, function(m) { return map[m]; });
            }
            
            handleTyping(e) {
                if (this.isCompleted) return;
                
                const input = this.typingInput.value;
                const inputLength = input.length;
                
                // Start timer on first keystroke
                if (!this.isRunning && inputLength > 0) {
                    this.startTimer();
                }
                
                // Check if user is trying to type beyond current position
                if (inputLength > this.currentPassageIndex + 1) {
                    // User is trying to type ahead - revert to correct position
                    this.typingInput.value = input.substring(0, this.currentPassageIndex);
                    return;
                }
                
                // Handle backspace
                if (inputLength < this.currentPassageIndex) {
                    // User pressed backspace - move cursor back
                    this.currentPassageIndex = inputLength;
                    this.updatePassageDisplay();
                    return;
                }
                
                // Handle new character
                if (inputLength === this.currentPassageIndex + 1) {
                    const typedChar = input[this.currentPassageIndex];
                    const expectedChar = this.passageChars[this.currentPassageIndex];
                    
                    // Strict character comparison
                    let isCorrect = typedChar === expectedChar;
                    
                    // Update counts
                    this.totalTypedChars++;
                    
                    if (isCorrect) {
                        // Remove error if previously marked at this position
                        if (this.errorMap.has(this.currentPassageIndex)) {
                            this.errorMap.delete(this.currentPassageIndex);
                        }
                    } else {
                        this.errors++;
                        // Mark this position as having an error
                        this.errorMap.set(this.currentPassageIndex, {
                            typed: typedChar,
                            expected: expectedChar
                        });
                    }
                    
                    this.currentPassageIndex++;
                    this.updatePassageDisplay();
                    
                    // Update error count display
                    this.errorCount.textContent = this.errors;
                }
            }
            
            handleKeyDown(e) {
                // Prevent default for tab key to avoid leaving textarea
                if (e.key === 'Tab') {
                    e.preventDefault();
                    return;
                }
                
                // Allow backspace, delete, arrow keys, etc.
                const allowedKeys = [
                    'Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 
                    'ArrowUp', 'ArrowDown', 'Home', 'End'
                ];
                
                if (allowedKeys.includes(e.key)) {
                    return;
                }
                
                // Prevent typing if test is completed
                if (this.isCompleted) {
                    e.preventDefault();
                    return;
                }
            }
            
            startTimer() {
                if (this.isRunning) return;
                
                this.isRunning = true;
                this.startTime = Date.now();
                
                this.timerInterval = setInterval(() => {
                    this.timeLeft--;
                    
                    // Update timer display
                    const minutes = Math.floor(this.timeLeft / 60);
                    const seconds = this.timeLeft % 60;
                    this.timeRemaining.textContent = 
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    // Update progress bar
                    const progressPercentage = ((this.totalTime - this.timeLeft) / this.totalTime) * 100;
                    this.progressFill.style.width = `${progressPercentage}%`;
                    
                    // Change color based on remaining time
                    if (this.timeLeft <= 30) {
                        this.timeRemaining.style.color = 'var(--timer-red)';
                    } else if (this.timeLeft <= 60) {
                        this.timeRemaining.style.color = 'var(--timer-yellow)';
                    }
                    
                    // End test when time is up
                    if (this.timeLeft <= 0) {
                        this.timeLeft = 0;
                        this.timeRemaining.textContent = '00:00';
                        this.progressFill.style.width = '100%';
                        this.completeTest();
                    }
                }, 1000);
            }
            
            completeTest() {
                clearInterval(this.timerInterval);
                this.isRunning = false;
                this.isCompleted = true;
                
                // Disable typing input
                this.typingInput.disabled = true;
                this.typingInput.classList.add('disabled');
                
                // Calculate results
                const elapsedMinutes = 3; // Exactly 3 minutes
                
                // Calculate WPM (1 word = 5 characters)
                const wpm = (this.totalTypedChars / 5) / elapsedMinutes;
                
                // Calculate Accuracy
                const accuracy = this.totalTypedChars > 0 ? 
                    ((this.totalTypedChars - this.errors) / this.totalTypedChars) * 100 : 0;
                
                // Update results display
                this.resultWPM.textContent = Math.round(wpm);
                this.resultErrors.textContent = this.errors;
                this.resultAccuracy.textContent = `${Math.min(100, Math.round(accuracy))}%`;
                
                // Show results section
                this.resultsContainer.classList.add('active');
                
                // Show ad container
                this.adContainer.style.display = 'block';
                this.adContainer.classList.add('visible');
                
                // Scroll to results
                setTimeout(() => {
                    this.resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 300);
            }
            
            resetTest() {
                // Reset all state
                clearInterval(this.timerInterval);
                
                this.currentPassageIndex = 0;
                this.errors = 0;
                this.totalTypedChars = 0;
                this.errorMap.clear();
                this.isRunning = false;
                this.isCompleted = false;
                this.timeLeft = this.totalTime;
                
                // Reset UI
                this.typingInput.value = '';
                this.typingInput.disabled = false;
                this.typingInput.classList.remove('disabled');
                this.typingInput.focus();
                
                this.startTestBtn.disabled = false;
                this.startTestBtn.innerHTML = '<i class="fas fa-play"></i> Start 3-Minute Test';
                this.startTestBtn.style.opacity = '1';
                
                this.timeRemaining.textContent = '03:00';
                this.timeRemaining.style.color = 'var(--timer-green)';
                this.errorCount.textContent = '0';
                this.progressFill.style.width = '0%';
                
                this.resultsContainer.classList.remove('active');
                this.adContainer.style.display = 'none';
                this.adContainer.classList.remove('visible');
                
                this.updatePassageDisplay();
            }
        }

        // Initialize the application when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            const typingTest = new ThreeMinuteTypingTest();
            window.typingTest = typingTest;
        });
    </script>
</body>
</html>
