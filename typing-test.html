<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Test | TypeNova</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        /* CSS Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #7c3aed;
            --primary-dark: #5b21b6;
            --primary-light: #a78bfa;
            --secondary: #0ea5e9;
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --dark-border: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --accent: #10b981;
            --error: #ef4444;
            --success: #22c55e;
            --warning: #f59e0b;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        h1, h2, h3, h4 {
            font-weight: 700;
            line-height: 1.2;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        button {
            cursor: pointer;
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        .container {
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .section {
            padding: 40px 0;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-primary:hover,
        .btn-primary:focus {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--text-primary);
            border: 2px solid var(--dark-border);
        }

        .btn-secondary:hover,
        .btn-secondary:focus {
            border-color: var(--primary);
            background-color: rgba(124, 58, 237, 0.1);
            transform: translateY(-3px);
        }

        /* Header / Navbar */
        header {
            position: sticky;
            top: 0;
            background-color: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border-bottom: 1px solid var(--dark-border);
        }

        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
        }

        .logo-highlight {
            color: var(--primary);
            font-weight: 800;
        }

        .nav-links {
            display: flex;
            gap: 25px;
            list-style: none;
        }

        .nav-link {
            font-weight: 500;
            position: relative;
            padding: 5px 0;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }

        .nav-link:hover::after,
        .nav-link:focus::after {
            width: 100%;
        }

        .nav-link:hover,
        .nav-link:focus {
            color: var(--primary-light);
        }

        .nav-cta {
            background-color: var(--primary);
            padding: 8px 20px;
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .nav-cta:hover,
        .nav-cta:focus {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Test Container */
        .test-container {
            max-width: 900px;
            margin: 30px auto;
            background-color: var(--dark-card);
            border-radius: var(--radius);
            border: 1px solid var(--dark-border);
            overflow: hidden;
        }

        .test-header {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, rgba(124, 58, 237, 0.1), rgba(14, 165, 233, 0.1));
        }

        .test-header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, var(--text-primary), var(--primary-light));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .test-header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Test Controls */
        .test-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            background-color: rgba(30, 41, 59, 0.7);
            border-bottom: 1px solid var(--dark-border);
            flex-wrap: wrap;
            gap: 15px;
        }

        .time-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .time-btn {
            padding: 8px 16px;
            background-color: transparent;
            border: 2px solid var(--dark-border);
            color: var(--text-secondary);
            border-radius: var(--radius);
            font-weight: 600;
            transition: var(--transition);
        }

        .time-btn:hover,
        .time-btn:focus {
            border-color: var(--primary);
            color: var(--text-primary);
        }

        .time-btn.active {
            background-color: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        .test-stats {
            display: flex;
            gap: 25px;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-box {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-light);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .test-actions {
            display: flex;
            gap: 10px;
        }

        /* Main Test Area - Single Box Design */
        .test-area {
            padding: 30px;
            position: relative;
        }

        .typing-container {
            position: relative;
            height: 300px;
            overflow: hidden;
            border: 2px solid var(--dark-border);
            border-radius: var(--radius);
            background-color: rgba(15, 23, 42, 0.9);
        }

        /* Text Display with Character-by-Character Highlighting */
        .text-display {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.3rem;
            line-height: 1.8;
            padding: 25px;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            color: var(--text-secondary);
            transition: transform 0.3s ease;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .text-display span {
            transition: all 0.1s ease;
            border-radius: 2px;
        }

        .text-display span.correct {
            color: var(--success);
        }

        .text-display span.incorrect {
            color: var(--error);
            background-color: rgba(239, 68, 68, 0.1);
        }

        .text-display span.current {
            background-color: rgba(124, 58, 237, 0.2);
            position: relative;
        }

        .text-display span.current::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background-color: var(--primary);
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        /* Input Area - Hidden but functional */
        .hidden-input {
            position: absolute;
            opacity: 0;
            width: 1px;
            height: 1px;
            pointer-events: none;
        }

        /* Instructions */
        .instructions {
            text-align: center;
            padding: 15px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            border-top: 1px solid var(--dark-border);
            background-color: rgba(30, 41, 59, 0.5);
        }

        /* Results Panel */
        .results-panel {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.95));
            border-radius: var(--radius);
            padding: 40px;
            margin-top: 30px;
            display: none;
            border: 1px solid var(--dark-border);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .results-panel.active {
            display: block;
        }

        .results-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .results-header h2 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary-light);
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .result-card {
            background-color: var(--dark-bg);
            padding: 20px;
            border-radius: var(--radius);
            text-align: center;
            border: 1px solid var(--dark-border);
            transition: var(--transition);
        }

        .result-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .result-value {
            font-size: 2.5rem;
            font-weight: 800;
            font-family: 'JetBrains Mono', monospace;
            margin-bottom: 10px;
        }

        .result-value.wpm {
            color: var(--success);
        }

        .result-value.accuracy {
            color: var(--accent);
        }

        .result-value.time {
            color: var(--secondary);
        }

        .result-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .result-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        /* Footer */
        footer {
            background-color: var(--dark-card);
            padding: 40px 0 20px;
            border-top: 1px solid var(--dark-border);
            margin-top: 40px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .footer-about h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
        }

        .footer-about p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .footer-links h4 {
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .footer-links ul {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 10px;
        }

        .footer-links a {
            color: var(--text-secondary);
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .footer-links a:hover,
        .footer-links a:focus {
            color: var(--primary-light);
            padding-left: 5px;
        }

        .social-icons {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .social-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: var(--dark-border);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 0.9rem;
        }

        .social-icon:hover,
        .social-icon:focus {
            background-color: var(--primary);
            transform: translateY(-3px);
        }

        .copyright {
            text-align: center;
            padding-top: 20px;
            border-top: 1px solid var(--dark-border);
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .test-container {
                margin: 15px auto;
            }
            
            .test-header h1 {
                font-size: 1.8rem;
            }
            
            .test-controls {
                flex-direction: column;
                align-items: stretch;
                padding: 15px;
            }
            
            .time-selector {
                justify-content: center;
            }
            
            .test-stats {
                justify-content: space-around;
            }
            
            .test-actions {
                justify-content: center;
            }
            
            .test-area {
                padding: 15px;
            }
            
            .typing-container {
                height: 250px;
            }
            
            .text-display {
                font-size: 1.1rem;
                padding: 20px;
            }
            
            .results-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .result-value {
                font-size: 2rem;
            }
        }

        @media (max-width: 480px) {
            .test-header h1 {
                font-size: 1.5rem;
            }
            
            .time-btn {
                padding: 6px 12px;
                font-size: 0.9rem;
            }
            
            .stat-value {
                font-size: 1.5rem;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .text-display {
                font-size: 1rem;
                padding: 15px;
            }
            
            .typing-container {
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <!-- Header / Navbar -->
    <header>
        <div class="container">
            <nav class="navbar" aria-label="Main Navigation">
                <a href="index.html" class="logo">Type<span class="logo-highlight">Nova</span></a>
                
                <ul class="nav-links" role="menu">
                    <li role="none"><a href="index.html" class="nav-link" role="menuitem">Home</a></li>
                    <li role="none"><a href="test.html" class="nav-link active" role="menuitem">Typing Test</a></li>
                    <li role="none"><a href="#" class="nav-link" role="menuitem">Practice</a></li>
                    <li role="none"><a href="#" class="nav-link" role="menuitem">Games</a></li>
                    <li role="none"><a href="#" class="nav-link" role="menuitem">Leaderboard</a></li>
                    <li role="none"><a href="#" class="nav-link nav-cta" role="menuitem">Login / Sign Up</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Test Section -->
    <main class="section">
        <div class="container">
            <div class="test-container">
                <div class="test-header">
                    <h1>Typing Speed Test</h1>
                    <p>Type the text below. Focus on accuracy and speed!</p>
                </div>

                <!-- Test Controls -->
                <div class="test-controls">
                    <div class="time-selector">
                        <button class="time-btn active" data-time="30">30 seconds</button>
                        <button class="time-btn" data-time="60">60 seconds</button>
                        <button class="time-btn" data-time="120">120 seconds</button>
                    </div>
                    
                    <div class="test-stats">
                        <div class="stat-box">
                            <div class="stat-value" id="time-left">30</div>
                            <div class="stat-label">Seconds</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="wpm">0</div>
                            <div class="stat-label">WPM</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="accuracy">100%</div>
                            <div class="stat-label">Accuracy</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-value" id="errors">0</div>
                            <div class="stat-label">Errors</div>
                        </div>
                    </div>
                    
                    <div class="test-actions">
                        <button class="btn btn-primary" id="start-btn">Start Test</button>
                        <button class="btn btn-secondary" id="reset-btn" disabled>Reset</button>
                    </div>
                </div>

                <!-- Single Box Typing Area -->
                <div class="test-area">
                    <div class="typing-container" id="typing-container">
                        <!-- Text will be displayed here character by character -->
                        <div class="text-display" id="text-display"></div>
                        
                        <!-- Hidden input for typing -->
                        <input 
                            type="text" 
                            class="hidden-input" 
                            id="typing-input"
                            autocomplete="off"
                            autocorrect="off"
                            autocapitalize="off"
                            spellcheck="false"
                        >
                    </div>
                    
                    <div class="instructions">
                        Press <strong>START TEST</strong> and begin typing. The text will automatically scroll as you type.
                    </div>
                </div>

                <!-- Results Panel -->
                <div class="results-panel" id="results-panel">
                    <div class="results-header">
                        <h2>Test Complete!</h2>
                        <p>Here are your typing test results:</p>
                    </div>
                    
                    <div class="results-grid">
                        <div class="result-card">
                            <div class="result-value wpm" id="result-wpm">0</div>
                            <div class="result-label">Words Per Minute</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value accuracy" id="result-accuracy">100%</div>
                            <div class="result-label">Accuracy</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value time" id="result-time">0s</div>
                            <div class="result-label">Time Taken</div>
                        </div>
                        <div class="result-card">
                            <div class="result-value" id="result-errors">0</div>
                            <div class="result-label">Errors</div>
                        </div>
                    </div>
                    
                    <div class="result-actions">
                        <button class="btn btn-primary" id="retry-btn">Try Again</button>
                        <button class="btn btn-secondary" id="practice-btn">Practice Mode</button>
                        <button class="btn btn-secondary" id="share-btn">Share Results</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-about">
                    <h3>Type<span style="color: var(--primary);">Nova</span></h3>
                    <p>TypeNova is your ultimate platform for improving typing speed and accuracy. Join our community and master your keyboard skills through tests, practice, and fun games.</p>
                    <div class="social-icons">
                        <a href="#" class="social-icon" aria-label="Follow us on Twitter">ùïè</a>
                        <a href="#" class="social-icon" aria-label="Follow us on Facebook">ùîΩ</a>
                        <a href="#" class="social-icon" aria-label="Follow us on Instagram">ùïÄ</a>
                        <a href="#" class="social-icon" aria-label="Subscribe on YouTube">ùïê</a>
                    </div>
                </div>
                <div class="footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="test.html">Typing Test</a></li>
                        <li><a href="#">Practice</a></li>
                        <li><a href="#">Games</a></li>
                        <li><a href="#">Leaderboard</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Resources</h4>
                    <ul>
                        <li><a href="#">Typing Tips</a></li>
                        <li><a href="#">Practice Guides</a></li>
                        <li><a href="#">WPM Standards</a></li>
                        <li><a href="#">Keyboard Layouts</a></li>
                        <li><a href="#">Blog</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                &copy; <span id="current-year">2023</span> TypeNova. All rights reserved. | Boost Your Speed. Master Your Keys.
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const textDisplay = document.getElementById('text-display');
            const typingInput = document.getElementById('typing-input');
            const typingContainer = document.getElementById('typing-container');
            const timeLeft = document.getElementById('time-left');
            const wpmDisplay = document.getElementById('wpm');
            const accuracyDisplay = document.getElementById('accuracy');
            const errorsDisplay = document.getElementById('errors');
            const startBtn = document.getElementById('start-btn');
            const resetBtn = document.getElementById('reset-btn');
            const timeButtons = document.querySelectorAll('.time-btn');
            const resultsPanel = document.getElementById('results-panel');
            const resultWPM = document.getElementById('result-wpm');
            const resultAccuracy = document.getElementById('result-accuracy');
            const resultTime = document.getElementById('result-time');
            const resultErrors = document.getElementById('result-errors');
            const retryBtn = document.getElementById('retry-btn');
            const practiceBtn = document.getElementById('practice-btn');
            const shareBtn = document.getElementById('share-btn');
            
            // Test state
            let testActive = false;
            let timeLimit = 30;
            let timeRemaining = timeLimit;
            let timerInterval = null;
            let startTime = null;
            let endTime = null;
            let currentCharIndex = 0;
            let correctChars = 0;
            let totalCharsTyped = 0;
            let errorCount = 0;
            let currentText = '';
            let charElements = [];
            
            // 15 Passages with varying lengths for different time limits
            const passages = [
                // Short passages (30 seconds)
                "The quick brown fox jumps over the lazy dog. This sentence contains all letters of the alphabet. Perfect for testing keyboard layout and typing speed.",
                "Programming requires logical thinking and problem-solving skills. Developers write code to create applications that solve real-world problems efficiently.",
                "Practice makes perfect when learning to type. Consistent daily practice helps improve both speed and accuracy significantly over time.",
                "Technology advances rapidly in today's digital age. Innovations in artificial intelligence and machine learning transform industries worldwide.",
                "Reading improves vocabulary and comprehension skills. Regular reading habits enhance cognitive abilities and expand knowledge across subjects.",
                
                // Medium passages (60 seconds)
                "The sun rises in the east and sets in the west, marking the passage of time throughout the day. Nature follows predictable patterns that humans have observed for centuries, from seasonal changes to celestial movements. Understanding these natural rhythms helps us plan our lives and appreciate the world around us.",
                "Effective communication is essential in both personal and professional relationships. Clear writing and speaking skills enable individuals to express ideas, share information, and collaborate successfully. Whether in emails, reports, or conversations, good communication builds trust and understanding between people.",
                "Physical exercise benefits both body and mind. Regular activity improves cardiovascular health, strengthens muscles, and reduces stress levels. Combining different types of exercise creates a balanced fitness routine that promotes overall well-being and longevity.",
                "Learning a new language opens doors to different cultures and perspectives. It enhances cognitive flexibility, improves memory, and provides practical advantages in an increasingly globalized world. Language acquisition requires consistent practice and exposure to authentic materials.",
                "Time management skills are crucial for productivity and success. Prioritizing tasks, setting realistic goals, and minimizing distractions help individuals accomplish more in less time. Effective time management reduces stress and creates space for both work and leisure activities.",
                
                // Long passages (120 seconds)
                "The history of computing spans centuries, from early mechanical calculators to modern quantum computers. Each technological breakthrough built upon previous discoveries, accelerating the pace of innovation. Today's interconnected world relies on complex networks that transmit information instantly across continents, transforming how we work, learn, and socialize. The future promises even more revolutionary changes as researchers explore artificial general intelligence and biocomputing.",
                "Environmental conservation has become increasingly important as human activities impact natural ecosystems. Sustainable practices aim to balance resource use with preservation needs, ensuring future generations can enjoy clean air, fresh water, and biodiversity. Individual actions, combined with policy changes and technological solutions, contribute to protecting our planet's delicate ecological balance.",
                "Economic principles influence decisions at personal, business, and governmental levels. Supply and demand dynamics, inflation rates, and employment trends shape financial landscapes worldwide. Understanding basic economic concepts helps individuals make informed choices about saving, investing, and spending in various market conditions.",
                "Creative expression through art, music, and literature enriches human experience across cultures and historical periods. Artistic works reflect societal values, challenge conventions, and provide emotional resonance for audiences. Supporting creative industries fosters innovation while preserving cultural heritage for future appreciation.",
                "Education systems evolve to meet changing societal needs and technological advancements. Traditional classroom settings now incorporate digital tools that facilitate personalized learning and global collaboration. Lifelong learning has become essential as knowledge expands rapidly in specialized fields and interdisciplinary areas."
            ];
            
            // Initialize
            loadNewText();
            updateCopyrightYear();
            
            // Event Listeners
            startBtn.addEventListener('click', startTest);
            resetBtn.addEventListener('click', resetTest);
            typingInput.addEventListener('input', handleTyping);
            typingInput.addEventListener('keydown', handleKeyDown);
            typingContainer.addEventListener('click', function() {
                if (testActive) {
                    typingInput.focus();
                }
            });
            
            timeButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (testActive) return;
                    
                    timeButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    timeLimit = parseInt(this.dataset.time);
                    timeRemaining = timeLimit;
                    timeLeft.textContent = timeRemaining;
                    resetTest();
                });
            });
            
            retryBtn.addEventListener('click', function() {
                resetTest();
                startTest();
            });
            
            practiceBtn.addEventListener('click', function() {
                alert('Practice mode will be available soon!');
            });
            
            shareBtn.addEventListener('click', function() {
                const wpm = resultWPM.textContent;
                const accuracy = resultAccuracy.textContent;
                const text = `I typed at ${wpm} WPM with ${accuracy} accuracy on TypeNova! Try it yourself at typenova.com`;
                
                if (navigator.share) {
                    navigator.share({
                        title: 'My Typing Test Results',
                        text: text,
                        url: window.location.href
                    });
                } else {
                    navigator.clipboard.writeText(text)
                        .then(() => alert('Results copied to clipboard!'))
                        .catch(() => prompt('Copy this text to share:', text));
                }
            });
            
            // Functions
            function loadNewText() {
                // Select passage based on time limit
                let passageIndex;
                if (timeLimit <= 30) {
                    passageIndex = Math.floor(Math.random() * 5); // First 5 short passages
                } else if (timeLimit <= 60) {
                    passageIndex = 5 + Math.floor(Math.random() * 5); // Next 5 medium passages
                } else {
                    passageIndex = 10 + Math.floor(Math.random() * 5); // Last 5 long passages
                }
                
                currentText = passages[passageIndex];
                currentCharIndex = 0;
                correctChars = 0;
                totalCharsTyped = 0;
                errorCount = 0;
                charElements = [];
                
                // Display text character by character
                textDisplay.innerHTML = '';
                for (let i = 0; i < currentText.length; i++) {
                    const span = document.createElement('span');
                    span.textContent = currentText[i];
                    span.dataset.index = i;
                    charElements.push(span);
                    textDisplay.appendChild(span);
                }
                
                // Update cursor position
                updateCursor();
                updateStats();
            }
            
            function startTest() {
                if (testActive) return;
                
                testActive = true;
                startTime = new Date();
                timeRemaining = timeLimit;
                
                // Enable input
                typingInput.disabled = false;
                typingInput.value = '';
                typingInput.focus();
                
                // Update buttons
                startBtn.disabled = true;
                startBtn.textContent = 'Testing...';
                resetBtn.disabled = false;
                
                // Start timer
                timerInterval = setInterval(updateTimer, 1000);
                
                // Disable time selection during test
                timeButtons.forEach(btn => btn.style.pointerEvents = 'none');
                
                // Scroll to ensure first character is visible
                scrollToCurrentChar();
            }
            
            function resetTest() {
                testActive = false;
                
                // Clear timer
                clearInterval(timerInterval);
                
                // Reset time
                timeRemaining = timeLimit;
                timeLeft.textContent = timeRemaining;
                
                // Reset input
                typingInput.value = '';
                typingInput.disabled = true;
                
                // Reset buttons
                startBtn.disabled = false;
                startBtn.textContent = 'Start Test';
                resetBtn.disabled = true;
                
                // Reset text highlighting
                charElements.forEach(charEl => {
                    charEl.className = '';
                });
                
                // Hide results
                resultsPanel.classList.remove('active');
                
                // Load new text
                loadNewText();
                
                // Enable time selection
                timeButtons.forEach(btn => btn.style.pointerEvents = 'auto');
            }
            
            function updateTimer() {
                timeRemaining--;
                timeLeft.textContent = timeRemaining;
                
                if (timeRemaining <= 0) {
                    endTest();
                }
            }
            
            function endTest() {
                testActive = false;
                endTime = new Date();
                
                // Clear timer
                clearInterval(timerInterval);
                
                // Disable input
                typingInput.disabled = true;
                typingInput.blur();
                
                // Calculate final results
                const timeTaken = timeLimit;
                const wpm = calculateWPM();
                const accuracy = calculateAccuracy();
                
                // Update results display
                resultWPM.textContent = wpm;
                resultAccuracy.textContent = accuracy + '%';
                resultTime.textContent = timeTaken + 's';
                resultErrors.textContent = errorCount;
                
                // Show results panel
                resultsPanel.classList.add('active');
                resultsPanel.scrollIntoView({ behavior: 'smooth' });
                
                // Update buttons
                startBtn.disabled = false;
                startBtn.textContent = 'Start Test';
                resetBtn.disabled = true;
                
                // Enable time selection
                timeButtons.forEach(btn => btn.style.pointerEvents = 'auto');
            }
            
            function handleTyping(e) {
                if (!testActive) return;
                
                const input = typingInput.value;
                const lastChar = input[input.length - 1] || '';
                
                // Reset input but keep functionality
                if (currentCharIndex < currentText.length) {
                    const expectedChar = currentText[currentCharIndex];
                    
                    // Update character highlighting
                    if (input.length > totalCharsTyped) {
                        // New character typed
                        if (lastChar === expectedChar) {
                            charElements[currentCharIndex].className = 'correct';
                            correctChars++;
                        } else {
                            charElements[currentCharIndex].className = 'incorrect';
                            errorCount++;
                        }
                        
                        currentCharIndex++;
                        totalCharsTyped++;
                        
                        // Update cursor position
                        updateCursor();
                        
                        // Auto-scroll to keep current character in view
                        scrollToCurrentChar();
                    } else if (input.length < totalCharsTyped) {
                        // Backspace pressed
                        currentCharIndex--;
                        totalCharsTyped--;
                        
                        // Reset character highlighting
                        charElements[currentCharIndex].className = '';
                        
                        // Update cursor position
                        updateCursor();
                        
                        // Adjust error count if needed
                        if (charElements[currentCharIndex].className === 'incorrect') {
                            errorCount = Math.max(0, errorCount - 1);
                        }
                    }
                    
                    updateStats();
                }
                
                // Check if all characters are typed
                if (currentCharIndex >= currentText.length) {
                    endTest();
                }
            }
            
            function handleKeyDown(e) {
                // Prevent default behavior for certain keys
                if (e.key === 'Backspace' && typingInput.value === '') {
                    e.preventDefault();
                }
                
                // Start test on any key if not started
                if (!testActive && e.key.length === 1) {
                    startTest();
                }
            }
            
            function updateCursor() {
                // Remove current class from all characters
                charElements.forEach(charEl => {
                    charEl.classList.remove('current');
                });
                
                // Add current class to current character
                if (currentCharIndex < charElements.length) {
                    charElements[currentCharIndex].classList.add('current');
                }
            }
            
            function scrollToCurrentChar() {
                if (currentCharIndex < charElements.length) {
                    const currentCharEl = charElements[currentCharIndex];
                    const container = typingContainer;
                    const containerHeight = container.clientHeight;
                    const charTop = currentCharEl.offsetTop;
                    const charHeight = currentCharEl.offsetHeight;
                    
                    // Calculate scroll position
                    const scrollPos
                                        const targetScroll = charTop - (containerHeight / 2) + (charHeight / 2);
                    
                    // Smooth scroll to keep current character centered
                    textDisplay.style.transform = `translateY(-${targetScroll}px)`;
                }
            }
            
            function updateStats() {
                if (!testActive) return;
                
                // Calculate WPM (Words Per Minute)
                const timeElapsed = (timeLimit - timeRemaining) || 1;
                const minutes = timeElapsed / 60;
                const wordsTyped = correctChars / 5; // Standard: 5 characters = 1 word
                const wpm = Math.round(wordsTyped / minutes);
                wpmDisplay.textContent = wpm > 0 ? wpm : 0;
                
                // Calculate accuracy
                const accuracy = totalCharsTyped > 0 
                    ? Math.round((correctChars / totalCharsTyped) * 100)
                    : 100;
                accuracyDisplay.textContent = accuracy + '%';
                
                // Update errors
                errorsDisplay.textContent = errorCount;
            }
            
            function calculateWPM() {
                if (!startTime || correctChars === 0) return 0;
                
                const timeElapsed = timeLimit; // Total test time
                const minutes = timeElapsed / 60;
                const wordsTyped = correctChars / 5;
                const wpm = Math.round(wordsTyped / minutes);
                return wpm > 0 ? wpm : 0;
            }
            
            function calculateAccuracy() {
                if (totalCharsTyped === 0) return 100;
                
                const accuracy = Math.round((correctChars / totalCharsTyped) * 100);
                return accuracy > 0 ? accuracy : 0;
            }
            
            function updateCopyrightYear() {
                const yearSpan = document.getElementById('current-year');
                if (yearSpan) {
                    yearSpan.textContent = new Date().getFullYear();
                }
            }
            
            // Initialize cursor position
            updateCursor();
        });
    </script>
</body>
</html>
